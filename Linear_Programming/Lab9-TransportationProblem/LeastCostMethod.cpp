/*
    ---------------------------
    Name    - Devjit Choudhury
    Roll No - 19MA20014
    ---------------------------
    TRANSPORTATION PROBLEM
    ---------------------------
    Least Cost Method
*/

/*
    LOGIC :-
    ----------
    eg.
        d1  d2  d3  d4  |
    s1  19  30  50  10  |   7
                        |
    s2  70  30  40  60  |   9
                        |
    s3  40  8   70  20  |   18
    ---------------------
        5   8   7   14      <34>

    Ttotal supply = Total demand = 34 (Balanced)

    Check if the given transportation part is balanced
        ie. Total Cost = Total Demand

-------------------------------------
        d1  d2  d3  d4  |
    s1  19  -   50  10  |   7
                        |
    s2  70  -   40  60  |   9
                        |
    s3  40  <8> 70  20  |   10
    ---------------------
        5   0   7   14      <34>
-------------------------------------
        d1  d2  d3  d4  |
    s1  -   -   -   <7> |   0
                        |
    s2  70  -   40  60  |   9
                        |
    s3  40  <8> 70  20  |   10
    ---------------------
        5   0   7   7      <34>
    If tie check for maximum allocation
-------------------------------------
        d1  d2  d3  d4  |
    s1  -   -   -   <7> |   0
                        |
    s2  70  -   40  -   |   9
                        |
    s3  40  <8> 70  <7> |   3
    ---------------------
        5   0   7   0      <34>
-------------------------------------
        d1  d2  d3  d4  |
    s1  -   -   -   <7> |   0
                        |
    s2  70  -   <7> -   |   2
                        |
    s3  40  <8> -   <7> |   3
    ---------------------
        5   0   0   0      <34>
-------------------------------------
        d1  d2  d3  d4  |
    s1  -   -   -   <7> |   0
                        |
    s2  70  -   <7> -   |   2
                        |
    s3  <3> <8> -   <7> |   0
    ---------------------
        2   0   0   0      <34>
-------------------------------------
        d1  d2  d3  d4  |
    s1  -   -   -   <7> |   0
                        |
    s2  <2> -   <7> -   |   0
                        |
    s3  <3> <8> -   <7> |   0
    ---------------------
        0   0   0   0      <34>

    Every time we find the cell among the remaining with least cost value

    Check out input and output of the given question at bottom

*/




#include <bits/stdc++.h>
using namespace std;

int n, m;
double costArray[100][100];
double supply[100];
double demand[100];
long long INF = 1e9;

////////////////////////////////////////////////////////////////////////////////////////////////////////
// Function To Display the Table for Transportation Problem
void display(double A[][100], double B[], double C[]) {

    
    cout<<left<<setw(10)<<""<<" | ";
    for(int j=1;j<=m;j++){
        cout<<left<<setw(10)<<"D["+to_string(j)+"]"<<" | ";
    }
    cout<<endl;
    cout<<"__________________________________________________________________"<<endl;
    for(int i=1; i<=n; i++){
        cout<<left<<setw(10)<<"s["+to_string(i)+"]"<<" | ";
        for(int j=1; j<=m; j++){
            cout<<left<<setw(10)<<A[i][j]<<" | ";
        }
        cout<<left<<setw(10)<<B[i]<<endl;
    }
    cout<<"__________________________________________________________________"<<endl;
    
    cout<<left<<setw(10)<<""<<" | ";
    for(int j=1; j<=m; j++){
        cout<<left<<setw(10)<<C[j]<<" | ";
    }
    cout<<endl;

}


/////////////////////////////////////////////////////////////////////////////////////////////////////////
// To check if the given Transportation Problem is Balanced or Not
// Balanced Transportation Problem => ( Total Supply = Total Demand )
bool checkIfBalanced(double S[], double D[]){
    double totalSupply = 0;
    double totalDemand = 0;
    for(int i=1; i<=n; i++){
        totalSupply += S[i];
    }
    for(int j=1; j<=m; j++){
        totalDemand += D[j];
    }
    if(abs(totalDemand - totalSupply) <= 0.001){
        return true;
    }else{
        return false;
    }
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////
// After every Iteration we need to mind the cell in Transportation Table will min Cost Values
// Returns the position of the Min Cost cell among the left cells
vector<pair<int, int>> findPosOfMin(double costArray[][100], bool occupied[][100]){
    vector<pair<int,int>> allpos;
    int min = INF;
    for(int i=1; i<=n; i++){
        for(int j=1; j<=m; j++){
            if(occupied[i][j] == false){
                if(costArray[i][j] < min){
                    allpos.clear();
                    allpos.push_back({i,j});
                    min = costArray[i][j];
                }else if(costArray[i][j] == min){
                    allpos.push_back({i,j});
                }
            }
        }
    }
    return allpos;
}



int main(){
    // ------------------------------------------------------------
    // Taking the input
    cout<<"Enter number of Supply Sources : ";
    cin>>n;
    cout<<"Enter number of Destinaton Demands : ";
    cin>>m;

    cout<<"Enter the Cost Values :-"<<endl;
    for(int i=1; i<=n; i++){
        for(int j=1; j<=m; j++){
            cout<<"Source : S["<<i<<"] -> Destination : D["<<j<<"] : ";
            cin>>costArray[i][j];
        }
    }

    cout<<"Enter Values of Supply from :- "<<endl;
    for(int i=1; i<=n; i++) {
        cout<<"Source ["<<i<<"] : ";
        cin>>supply[i];
    }

    cout<<"Enter Value of Demand for :- "<<endl;
    for(int j=1; j<=m; j++) {
        cout<<"Destination ["<<j<<"] : ";
        cin>>demand[j];
    }

    // ------------------------------------------------------------
    // Displaying the Initial Transportation Table
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
    cout<<"The Initial Transportation Table :-"<<endl;
    display(costArray, supply, demand);
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
    // ------------------------------------------------------------
    // Chekcking if the problem is Balanced
    bool isBalanced = checkIfBalanced(supply, demand);

    // If not balanced -> display message and Exit
    if(!isBalanced) {
        cout<<"The given Transportation problem is not balanced"<<endl;
        return 0;
    }

    // ------------------------------------------------------------
    // creating a copy of CostArray, supply, demand
    // CostArrayCopy -> will contain Number of Unots for each source to Destination
    double costArrayCopy[100][100], supplyCopy[100], demandCopy[100];
    bool occupied[100][100];
    for(int i=1; i<=n; i++){
        for(int j=1; j<=m; j++){
            costArrayCopy[i][j] = costArray[i][j];
            occupied[i][j] = false;
        }
    }
    for(int i=1; i<=n; i++){
        supplyCopy[i] = supply[i];
    }
    for(int j=1; j<=m; j++){
        demandCopy[j] = demand[j];
    }

    // ------------------------------------------------------------
    // Iterating to get solution - Check out the LOGIC commented Above
    int iterationCount = 1;
    while (iterationCount <= n+m-1) {
        vector<pair<int, int>> posArr = findPosOfMin(costArray, occupied);
        if((int)posArr.size()==0){
            break;
        }
        pair<int, int> pos = {-1,-1};
        double mx = -INF;
        // now in all eleemts in all pos maximize allocation
        for(pair<int, int> x : posArr) {
            double temp;
            if(supplyCopy[x.first] >= demandCopy[x.second]){
                temp = supplyCopy[x.first];
            }else{
                temp = demandCopy[x.second];
            }

            if(temp > mx){
                pos = x;
                mx = temp;
            }
        }
        if(pos.first == -1 && pos.second == -1){
            break;
        }


        occupied[pos.first][pos.second] = true;
        if(supplyCopy[pos.first] <= demandCopy[pos.second]) {
            costArrayCopy[pos.first][pos.second] = supplyCopy[pos.first];
            for(int j=1; j<=m; j++){
                if(j==pos.second){
                    continue;
                }else{
                    if(occupied[pos.first][j] == true){
                        continue;
                    }else{
                        occupied[pos.first][j] = true;
                        costArrayCopy[pos.first][j] = 0;
                    }
                }
            }
            demandCopy[pos.second] -= supplyCopy[pos.first];
            supplyCopy[pos.first] = 0;
        }else{
            costArrayCopy[pos.first][pos.second] = demandCopy[pos.second];
            for(int i=1; i<=n; i++){
                if(i==pos.first){
                    continue;
                }else{
                    if(occupied[i][pos.second] == true){
                        continue;
                    }else{
                        occupied[i][pos.second] = true;
                        costArrayCopy[i][pos.second] = 0;
                    }
                }
            }
            supplyCopy[pos.first] -= demandCopy[pos.second];
            demandCopy[pos.second] = 0;
        }
        cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
        cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
        cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
        cout<<"Transportation Table after Interation Number : "<<iterationCount<<endl;
        display(costArrayCopy, supplyCopy, demandCopy);
        cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
        cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
        cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
        iterationCount++;
    }
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
    cout<<"Transportation Table after Interation Number : "<<iterationCount<<endl;
    display(costArrayCopy, supplyCopy, demandCopy);
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;
    cout<<"--------------------------------------------------------------------------------------------------------"<<endl;



    cout<<"----------------------------------------------------------"<<endl;
    cout<<"Basic Feasible Solution :- "<<endl;
    double totalCost = 0;
    for(int i=1; i<=n; i++){
        for(int j=1; j<=m; j++){
            if(costArrayCopy[i][j] > 0){
                cout<<"S["<<i<<"] -> D["<<j<<"] = "<<costArrayCopy[i][j]<<endl;
                totalCost = totalCost + costArrayCopy[i][j] * costArray[i][j];
            }
        }
    }
    cout<<"----------------------------------------------------------"<<endl;
    cout<<"Transportation Cost :- "<<endl;
    cout<<totalCost<<endl;
    cout<<"----------------------------------------------------------"<<endl;
      
}

/*
Input 1 -
3 4
2 3 5 1
7 3 4 6
4 1 7 2
8 10 20
6 8 9 15

Output 1 -
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
The Initial Transportation Table :-
           | D[1]       | D[2]       | D[3]       | D[4]       |
__________________________________________________________________
s[1]       | 2          | 3          | 5          | 1          | 8
s[2]       | 7          | 3          | 4          | 6          | 10
s[3]       | 4          | 1          | 7          | 2          | 20
__________________________________________________________________
           | 6          | 8          | 9          | 15         |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 1
           | D[1]       | D[2]       | D[3]       | D[4]       |
__________________________________________________________________
s[1]       | 2          | 0          | 5          | 1          | 8
s[2]       | 7          | 0          | 4          | 6          | 10
s[3]       | 4          | 8          | 7          | 2          | 12
__________________________________________________________________
           | 6          | 0          | 9          | 15         |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 2
           | D[1]       | D[2]       | D[3]       | D[4]       |
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 8          | 0
s[2]       | 7          | 0          | 4          | 6          | 10
s[3]       | 4          | 8          | 7          | 2          | 12
__________________________________________________________________
           | 6          | 0          | 9          | 7          | 
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 3
           | D[1]       | D[2]       | D[3]       | D[4]       |
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 8          | 0
s[2]       | 7          | 0          | 4          | 0          | 10
s[3]       | 4          | 8          | 7          | 7          | 5
__________________________________________________________________
           | 6          | 0          | 9          | 0          | 
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 4
           | D[1]       | D[2]       | D[3]       | D[4]       |
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 8          | 0
s[2]       | 7          | 0          | 9          | 0          | 1
s[3]       | 4          | 8          | 0          | 7          | 5
__________________________________________________________________
           | 6          | 0          | 0          | 0          |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 5
           | D[1]       | D[2]       | D[3]       | D[4]       |
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 8          | 0
s[2]       | 7          | 0          | 9          | 0          | 1
s[3]       | 5          | 8          | 0          | 7          | 0
__________________________________________________________________
           | 1          | 0          | 0          | 0          |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 6
           | D[1]       | D[2]       | D[3]       | D[4]       |
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 8          | 0
s[2]       | 1          | 0          | 9          | 0          | 0
s[3]       | 5          | 8          | 0          | 7          | 0
__________________________________________________________________
           | 0          | 0          | 0          | 0          |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 7
           | D[1]       | D[2]       | D[3]       | D[4]       |
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 8          | 0
s[2]       | 1          | 0          | 9          | 0          | 0
s[3]       | 5          | 8          | 0          | 7          | 0
__________________________________________________________________
           | 0          | 0          | 0          | 0          |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
----------------------------------------------------------
Basic Feasible Solution :-
S[1] -> D[4] = 8
S[2] -> D[1] = 1
S[2] -> D[3] = 9
S[3] -> D[1] = 5
S[3] -> D[2] = 8
S[3] -> D[4] = 7
----------------------------------------------------------
Transportation Cost :-
93
----------------------------------------------------------

*/

/*
Input 2 -
3 4
19 30 50 10
70 30 40 60
40 8 70 20
7 9 18
5 8 7 14

Output 2 -
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
The Initial Transportation Table :-
           | D[1]       | D[2]       | D[3]       | D[4]       |
__________________________________________________________________
s[1]       | 19         | 30         | 50         | 10         | 7
s[2]       | 70         | 30         | 40         | 60         | 9
s[3]       | 40         | 8          | 70         | 20         | 18
__________________________________________________________________
           | 5          | 8          | 7          | 14         |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 1
           | D[1]       | D[2]       | D[3]       | D[4]       |
__________________________________________________________________
s[1]       | 19         | 0          | 50         | 10         | 7
s[2]       | 70         | 0          | 40         | 60         | 9
s[3]       | 40         | 8          | 70         | 20         | 10
__________________________________________________________________
           | 5          | 0          | 7          | 14         |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 2
           | D[1]       | D[2]       | D[3]       | D[4]       |
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 7          | 0
s[2]       | 70         | 0          | 40         | 60         | 9
s[3]       | 40         | 8          | 70         | 20         | 10
__________________________________________________________________
           | 5          | 0          | 7          | 7          |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 3
           | D[1]       | D[2]       | D[3]       | D[4]       | 
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 7          | 0
s[2]       | 70         | 0          | 40         | 0          | 9
s[3]       | 40         | 8          | 70         | 7          | 3
__________________________________________________________________
           | 5          | 0          | 7          | 0          |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 4
           | D[1]       | D[2]       | D[3]       | D[4]       | 
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 7          | 0
s[2]       | 70         | 0          | 7          | 0          | 2
s[3]       | 40         | 8          | 0          | 7          | 3
__________________________________________________________________
           | 5          | 0          | 0          | 0          |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 5
           | D[1]       | D[2]       | D[3]       | D[4]       | 
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 7          | 0
s[2]       | 70         | 0          | 7          | 0          | 2
s[3]       | 3          | 8          | 0          | 7          | 0
__________________________________________________________________
           | 2          | 0          | 0          | 0          |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 6
           | D[1]       | D[2]       | D[3]       | D[4]       | 
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 7          | 0
s[2]       | 2          | 0          | 7          | 0          | 0
s[3]       | 3          | 8          | 0          | 7          | 0
__________________________________________________________________
           | 0          | 0          | 0          | 0          |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
Transportation Table after Interation Number : 7
           | D[1]       | D[2]       | D[3]       | D[4]       | 
__________________________________________________________________
s[1]       | 0          | 0          | 0          | 7          | 0
s[2]       | 2          | 0          | 7          | 0          | 0
s[3]       | 3          | 8          | 0          | 7          | 0
__________________________________________________________________
           | 0          | 0          | 0          | 0          |
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------
----------------------------------------------------------
Basic Feasible Solution :-
S[1] -> D[4] = 7
S[2] -> D[1] = 2
S[2] -> D[3] = 7
S[3] -> D[1] = 3
S[3] -> D[2] = 8
S[3] -> D[4] = 7
----------------------------------------------------------
Transportation Cost :-
814
----------------------------------------------------------
*/